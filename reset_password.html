<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>パスワード再設定</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .form-field { margin-bottom: 15px; }
    label { display: inline-block; width: 150px; }
    input { padding: 5px; }
    button { padding: 5px 10px; }
    #message { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>パスワードをリセット</h1>
  <div id="auth-status">認証チェック中...</div>
  
  <form id="resetPasswordForm" style="display: none;">
    <div class="form-field">
      <label for="newPassword">新しいパスワード:</label>
      <input type="password" id="newPassword" name="newPassword" required>
    </div>
    <button type="submit">パスワードを更新</button>
  </form>
  
  <div id="message"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase 初期化
    const SUPABASE_URL = "https://xalrqqutkxzwzvahqpjg.supabase.co"; // 実際のプロジェクトIDに変更
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhbHJxcXV0a3h6d3p2YWhxcGpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkyNDE2MDIsImV4cCI6MjA1NDgxNzYwMn0.OzfyNlLHmZJOiWnCgsUCnvA9npaDXzVeASr-HVOT1MA"; // 実際のanonキーに変更
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function checkAuthStatus() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if (error || !user) {
        document.getElementById("auth-status").textContent = "認証エラー: 正しいリンクを開いてください。";
        return;
      }
      document.getElementById("auth-status").style.display = "none";
      document.getElementById("resetPasswordForm").style.display = "block";
    }

    // ページ読み込み時に認証チェック
    checkAuthStatus();

    document.getElementById("resetPasswordForm").addEventListener("submit", async (event) => {
      event.preventDefault();
      const newPassword = document.getElementById("newPassword").value;
      const messageDiv = document.getElementById("message");

      // パスワードを更新
      const { data, error } = await supabase.auth.updateUser({ password: newPassword });
      if (error) {
        messageDiv.textContent = "エラー: " + error.message;
      } else {
        messageDiv.textContent = "パスワードが更新されました！ログインページへ移動してください。";
        setTimeout(() => {
          window.location.href = "login.html"; // ログインページへリダイレクト
        }, 2000);
      }
    });
  </script>
</body>
</html>
